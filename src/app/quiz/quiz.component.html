<div class="quiz-container">
    <h1>{{ translations.quiz?.title }}</h1>
    <div class="quiz-content" *ngIf="!quizFinished">
        <div class="question">
            <p>{{ currentQuestionIndex + 1 }}/{{ questions.length }}</p>
            <img [src]="questions[currentQuestionIndex].flagUrl" alt="Drapeau" width="200">
        </div>
        <form class="answer" (ngSubmit)="submitAnswer()">
            <input 
                type="text" 
                [(ngModel)]="userAnswer" 
                name="country" 
                placeholder="{{ translations.quiz?.placeholder }}" 
                required
                class="form-control"
                [disabled]="feedback !== ''"
                autofocus
                #countryInput
            >
            <button class="btn btn-primary" type="submit" [disabled]="feedback !== ''">{{ translations.quiz?.submit }}</button>
        </form>
        <div *ngIf="feedback" class="feedback">
            {{ feedback }}
        </div>
    </div>

    

    <div class="quiz-content" *ngIf="quizFinished">
        <h2>{{ translations.quiz?.gameOver }}</h2>
        <p>{{ translations.quiz?.yourScore }} : {{ score }} / {{ questions.length }}</p>
        <div class="actions">

            <button class="btn btn-save" (click)="openSavePopup()">
                Sauvegarder ma partie
            </button>
            <button class="btn btn-primary" (click)="restartQuiz()">
                {{ translations.quiz?.restart }}
            </button>
            
        </div>

        <div class="popup-backdrop" *ngIf="showSavePopup">
            <div class="popup-card">
                <h3>Sauvegarder la partie</h3>
                <p>Entrez votre nom d'utilisateur :</p>

                <input type="text" [(ngModel)]="savedUsername" placeholder="Nom d'utilisateur" />

                <div class="popup-actions">
                    <button class="btn btn-primary" (click)="saveGame()" *ngIf="!saveSuccess">Sauvegarder</button>
                    <button class="btn btn-secondary" (click)="closeSavePopup()">Annuler</button>
                </div>

                <div *ngIf="saveSuccess" class="success-message">
                    Partie sauvegardée avec succès !
                </div>
                <div *ngIf="saveError" class="form-error">
                    Erreur : {{ saveError }}
                </div>
            </div>
        </div>
    </div>
    
    <div class="back-btn-container">
        <button class="btn" routerLink="/quiz_choice">{{ translations.quiz?.back }}</button>
    </div>
</div>