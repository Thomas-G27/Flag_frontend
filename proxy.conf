LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule rewrite_module modules/mod_rewrite.so
LoadModule headers_module modules/mod_headers.so
LoadModule mime_module modules/mod_mime.so

<VirtualHost *:80>
    ProxyPreserveHost On

    # Proxy des appels API vers le backend
    ProxyPass /api/ http://backend:8080/api/
    ProxyPassReverse /api/ http://backend:8080/api/

    DocumentRoot "/usr/local/apache2/htdocs"
    <Directory "/usr/local/apache2/htdocs">
        Require all granted
        Options Indexes FollowSymLinks
        
        # SPA fallback - toutes les routes non-existantes vont à index.html
        FallbackResource /index.html
    </Directory>

    # Types MIME pour les assets
    <FilesMatch "\.js$">
        Header set Content-Type "application/javascript; charset=utf-8"
    </FilesMatch>
    <FilesMatch "\.css$">
        Header set Content-Type "text/css; charset=utf-8"
    </FilesMatch>
    <FilesMatch "\.json$">
        Header set Content-Type "application/json; charset=utf-8"
    </FilesMatch>

    # Headers pour éviter le cache en dev
    <FilesMatch "\.html$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires "0"
    </FilesMatch>
</VirtualHost>